@if (publicacion) {
  <div class="container">
    <div class="header">
      <button class="btn-volver" (click)="volver()">‚Üê Volver</button>
    </div>

    <div class="publicacion-detalle">
      <div class="publicacion-header">
        <img [src]="publicacion.userProfileImage || '/assets/default-avatar.png'" class="avatar" alt="Avatar">
        <div class="info">
          <h3>{{ publicacion.userName || 'Usuario' }}</h3>
          <span class="fecha">{{ publicacion.date | date:'short' }}</span>
        </div>
      </div>

      <div class="publicacion-contenido">
        <p>{{ publicacion.content }}</p>
        @if (publicacion.images && publicacion.images.length > 0) {
          <div class="imagenes-grid">
            @for (imagen of publicacion.images; track imagen) {
              <img [src]="imagen" class="imagen-publicacion" alt="Imagen de publicaci√≥n">
            }
          </div>
        }
      </div>

      <div class="publicacion-stats">
        <span>‚ù§Ô∏è {{ publicacion.likes?.length || 0 }} me gusta</span>
        <span>üí¨ {{ publicacion.comments?.length || 0 }} comentarios</span>
      </div>
    </div>

    <div class="comentarios-seccion">
      <h3>Comentarios</h3>

      <div class="comentarios-lista">
        @for (comentario of comentarios; track comentario._id) {
          <div class="comentario">
            <div class="comentario-header">
              <img [src]="comentario.userProfileImage || '/assets/default-avatar.png'" class="avatar-pequeno" alt="Avatar">
              <div class="comentario-info">
                <strong>{{ comentario.userName }}</strong>
                <span class="fecha-comentario">{{ comentario.date | date:'short' }}</span>
                @if (comentario.modified) {
                  <span class="modificado">(editado)</span>
                }
              </div>
              @if (isOwner(comentario) && editingCommentId !== comentario._id) {
                <button class="btn-editar" (click)="iniciarEdicion(comentario)">
                  Editar
                </button>
              }
            </div>

            @if (editingCommentId !== comentario._id) {
              <div class="comentario-contenido">
                <p>{{ comentario.content }}</p>
              </div>
            }

            @if (editingCommentId === comentario._id) {
              <div class="comentario-edicion">
                <textarea 
                  [(ngModel)]="editingCommentContent" 
                  class="textarea-edicion"
                  rows="3">
                </textarea>
                <div class="botones-edicion">
                  <button class="btn-guardar" (click)="guardarEdicion(publicacion._id, comentario._id)">Guardar</button>
                  <button class="btn-cancelar" (click)="cancelarEdicion()">Cancelar</button>
                </div>
              </div>
            }
          </div>
        }
      </div>

      @if (hasMore && !isLoading) {
        <div class="cargar-mas">
          <button class="btn-cargar-mas" (click)="cargarMas()">Cargar m√°s comentarios</button>
        </div>
      }

      @if (isLoading) {
        <div class="loading">
          <p>Cargando comentarios...</p>
        </div>
      }
    </div>
  </div>
}
